type: vertical-stack
cards:
  #### Title Row ##################################################################################>
  - type: horizontal-stack
    cards:
      #### Title Card ####>
      - type: custom:button-card
        name: Air Exchange
        icon: mdi:fan
        template: title_blue
      # - type: custom:button-card
      #   template: gap
      #   variables:
      #     _height: 40px
      #     _width: 20px

      #### Frequency Card ####>
      - type: custom:button-card
        template: 
          - info_mini
          - transparent
        # variables:
        tap_action:
          action: more-info
        entity: input_number.air_circulation_frequency
        icon: mdi:clock-time-nine-outline
      #### Window Card ####>
      - type: custom:button-card
        template: 
          - info_mini
          - transparent
          - no_actions
        show_state: false
        variables:
          _icon_color: 'var(--ha-card-background)'
          _style:
            opacity:
              icon: 1
          _width: 40px
          _symbol: >
            [[[
              switch (entity.state) {
                case 'on':
                  return 'mdi:fan-off'
                case 'off':
                  return 'mdi:fan'
                default:
                  return 'mdi:fan-alert!'
              }
            ]]]
        entity: binary_sensor.air_exchange_contact_contact
        icon: mdi:window-open
        styles:
          custom_fields:
            symbol:
              - width: 22px
              - height: 22px
              - position: absolute
              - justify-self: center
              - align-self: end
              - margin-top: 0
              - margin-bottom: 3px
              - opacity: "[[[ return (entity.state == 'off') ? 1 : 0.6 ]]]"
              # - color: "[[[ return (entity.state == 'off') ? 'var(--accent-color)' : 'var(--paper-item-icon-color)' ]]]"
              - color: 'var(--paper-item-icon-color)'
      #### ON/OFF Card ####>
      - type: custom:button-card
        template:
          - button_mini
          - dynamic_icons
        entity: input_boolean.air_circulation
        variables:
          _icon: mdi:air-purifier-off
          _icon_on: mdi:air-purifier
          _height: 40px
          _width: 70px
        color_type: card

  #### Controls ###################################################################################>
  - type: grid
    columns: 2
    square: false
    cards:
      - type: horizontal-stack
        cards:
          #### Intake Fan ####>
          - type: custom:button-card
            template:
              - style_helper
              - interactive
            variables:
              _style:
                interactive: true
              _lock: "[[[ return states['binary_sensor.air_exchange_contact_contact'].state == 'on' ]]]"
            tap_action:
              action: toggle
            hold_action:
              action: more-info
            color: auto
            show_name: true
            show_state: false
            lock:
              enabled: "[[[ return variables._lock ]]]"
            entity: switch.smart_plug_12_usb
            icon: mdi:fan
            name: '+'
            styles:
              grid:
                - position: relative
              card:
                - height: 50px
              lock:
                - display: none
              name:
                - color: '#00b59d'
                - font-size: 25px
                - position: absolute
                - justify-self: center
                - margin-left: 35px
                - margin-bottom: 20px
            state:
              - value: 'on'
                spin: true
                styles:
                  icon:
                    - color: '#00b59d'
                  name:
                    - color: 'var(--primary-text-color)'
          #### Extraction Fan ####>
          - type: custom:button-card
            template:
              - style_helper
              - interactive
            variables:
              _lock: "[[[ return states['binary_sensor.air_exchange_contact_contact'].state == 'on' ]]]"
              _style:
                interactive: true
            tap_action:
              action: toggle
            hold_action:
              action: more-info
            color: auto
            show_name: true
            show_state: false
            entity: switch.smart_plug_12
            icon: mdi:fan
            name: '-'
            styles:
              grid:
                - position: relative
              card:
                - height: 50px
              name:
                - color: '#63cbfb'
                - font-size: 45px
                - position: absolute
                - justify-self: center
                - margin-left: 35px
                - margin-bottom: 20px
            state:
              - value: 'on'
                spin: true
                styles:
                  icon:
                    - color: '#63cbfb'
                  name:
                    - color: 'var(--primary-text-color)'

      #### Action Card ####>
      - type: custom:button-card
        template: button_action
        entity: input_boolean.air_circulation_status
        styles:
          card:
            - height: 50px
        tap_action:
          action: call-service
          service: button.press
          service_data:
            entity_id: >
              [[[ 
                  return entity.state == 'off'
                  ? 'button.start_air_circulation'
                  : 'button.stop_air_circulation' 
              ]]]
  #### Graphs #####################################################################################>
  - type: vertical-stack
    cards:
      - type: custom:mini-graph-card
        name: Air Exchange Last Hour
        hours_to_show: 1
        points_per_hour: 60
        decimals: 0
        line_width: 2
        font_size_header: 10
        align_header: left
        show:
          fill: true
          legend: true
          state: false
          icon: false
          name: false
        entities:
          - entity: switch.smart_plug_12_usb
            name: Intake
            color: '#00b59d'
          - entity: switch.smart_plug_12
            name: Extraction
            color: '#63cbfb'
        state_map:
          - value: 'off'
          - value: 'on'
        group: true
        height: 30
        smoothing: false
        animate: true
        style: |
          ha-card {
            background: none;
            border: none;
            border-radius: none;
            box-shadow: none;
            margin-top: 0;
          }
          .graph__legend {
            padding: 0 !important;
            width: 50% !important;
            height: 15px !important;
            margin-top: -5px !important;
          }
          .graph__legend__item {
            margin: 0 5px 0 5px !important;
            font-size: 12px;
          }
      - type: custom:mini-graph-card
        name: Air Exchange 12hrs
        hours_to_show: 12
        points_per_hour: 12
        decimals: 0
        line_width: 1
        font_size_header: 10
        align_header: left
        show:
          fill: true
          legend: false
          state: false
          icon: false
          name: false
        entities:
          - entity: switch.smart_plug_12_usb
            name: Intake
            color: '#00b59d'
          - entity: switch.smart_plug_12
            name: Extraction
            color: '#63cbfb'
        state_map:
          - value: 'off'
          - value: 'on'
        group: true
        height: 30
        smoothing: true
        style: |
          ha-card {
            background: none;
            border: none;
            border-radius: none;
            box-shadow: none;
          }
          .graph__legend {
            padding: 0 !important;
          }
          .graph__legend__item {
            margin: 0 !important;
            font-size: 12px
          }
  #### Info Footer #####################################################################################>
  - type: custom:button-card
    template:
      - info
    variables:
      _items:
        - entity_id: sensor.air_quality_den_temperature
          name: Temperature
        - entity_id: sensor.air_quality_den_humidity
          name: Humidity
        - entity_id: input_number.air_circulation_frequency
          name: Frequency
          icon: mdi:clock-outline
        - entity_id: counter.air_circulation_run_total
          name: Cycles

